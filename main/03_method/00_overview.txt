This covers two things:

1. How I modified the images to make segmentation easier.

# first try
State goal again
3D information about cells
The GFP profile
Each set of images and their uses

To find cells in a 3D environment, the images containing the most useful information need to be found. The GFP channel contains reliable 3D information about the cells. The Brightfield channel provides edges and other features that can be used to describe them. To combine these two channels, I built a database that could associate and access pixel data from any part of the images. I then scanned the GFP image set in Z to build up a GFP profile for each pixel in X and Y. This mean of and variance of this vertical profile gave an indication of the presence of an object, regardless of its absolute intensity. This meant parts of an object with low absolute intensity could be found with the GFP profile. The Z peak of the profile could be used to find the location of the object in Z, at least the part located at the X and Y of the pixel. A single image, known as zMod, could then be generated from the 3D bulk. The intensity of each pixel in X and Y is proportional to its Z position, so that a type of "terrain" containing 3D information about the image set could be built up. This zMod image was then use to produce another image, called zBF, which contained pixel values drawn from the XYZ locations in the image set indicated by zMod. This meant that every object in the zBF image was in focus. This could then be fed into cell segmentation software.

# second try
The cell segmentation software used, CellProfiler, operates most effectively on consistent and easily identifiable 2D features. To work with images from a 3D environment, an algorithm was developed to convert general 3D data into 2D images containing the desired features, such as edges and cell protrusions. The 3D dataset consists of planar images in a vertical stack, such that X,Y coordinates can refer to pixels in a single image, but a Z coordinate will refer to a different image in the stack. Pixel intensities in a single stack can be accessed by specifying X,Y,Z coordinates. More generally, a T (time) coordinate can also be specified, and a channel "coordinate" can help refer to the same physical location but represented in an image gathered using a different light source or camera system. For example, GFP fluorescence data is gathered separately, but concurrently, with brightfield image data. A database model was built to allow this type of access to pixel data, so that it could be manipulated and images could be modified easily. In addition to modifying images, 3D information organised in this way could be used to flatten the environment and create 2D images.

The location of an object of interest in the environment affects the quality of its appearance in different images in the data. If the cell is physically at the top of the environment, it will appear blurred and distorted in brightfield images gathered at the bottom. When viewed in the GFP, fluorescence data gathered from the cell will be visible at the top of the environment, but not at levels far away from the cell. Fixing X and Y within a cell horizontally and varying Z, a vertical profile of the pixel intensities can be found. Pixels will have low values in the background and high values in the presence of cells. A column of pixels at a cell location will give a smooth curve of intensities, increasing to maximum at the centre Z position of the cell. This allows cells to be located in Z. This process was repeated for every pixel in the image. If the X,Y location contains no cells at any level, the "GFP profile" will remain very flat and close to its low maximum, thus having a low variance. When a cell is found, the distribution will vary as the intensity increases from the background to the level inside a cell. This distribution will have a high variance. Pixels in X,Y can be categorised by the properties of their distributions. For example, a key ingredient generated is a 2D image called zMean, in which each pixel holds the value of the mean of the vertical GFP distribution. A high mean indicates a background pixel.

2. How I went about the segmentation using the improved images.

# first try
To ensure good segmentation, a combination of the images produced was fed into the chosen cell segmentation software, CellProfiler. The image containing the best features for segmentation, zBF, was not enough to produce reliable masks since the way CellProfiler works means that a small gap in an edge will cause the segmentation to spill into the background, since the background and the interior of a cell were a similar colour. I first marked the centre of each cell, and made the zDiff image. This used zMod and compare the Z of every point in the image with the Z of each marker. A higher value meant a Z closer to the Z of the marker. In this way, the parts of the image at the same level as a marker (the level of the object) were highlighted in the recognizer. This highlight formed the boundary of the segmentation. I made an artificial edge in the image that prevented the segmentation from spilling into the background. This would sometimes cutoff part of the segmentation that extended outside the GFP. This was because some of the cell protrusions contained no GFP above the background.

After obtaining the boundary, the zBF image could be segmented normally using a new image, zEdge, containing the artificial edge. In this way, the conventional 2D segmentation was enhanced by using 3D information.
